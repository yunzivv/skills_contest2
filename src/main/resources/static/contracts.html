<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <title>계약 관리</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body style="margin: 0; padding: 0;">
<div style="width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; background-color: #eeeeee;">
    <div style="width: 50%; height: 90%; text-align: center; padding: 20px 10px;
    display: flex; flex-direction: column; border-radius: 10px; background-color: white;">


            <form id="contractsForm" action="" style="display: flex; height: 15%;">
                <ul>
                    <li>
                        <div>고객코드:</div>
                        <input type="text" id="code" name="code" readonly>
                    </li>
                    <li>
                        <div>고 객 명:</div>
                        <select id="name" name="name" onchange="fetchCustomer(this.value)">
                        </select>
                    </li>
                    <li>
                        <div>생년월일:</div>
                        <input type="date" id="birth" name="birth" readonly>
                    </li>
                    <li>
                        <div>연 락 처:</div>
                        <input type="tel" id="tel" name="tel" readonly>
                    </li>
                </ul>
                <ul>
                    <li>
                        <div>보험상품:</div>
                        <select id="contractName" name="contractName">
                        </select>
                    </li>

                    <li>
                        <div>가입금액:</div>
                        <input type="text" id="regPrice" name="regPrice">
                    </li>

                    <li>
                        <div>월보험료:</div>
                        <input type="text" id="monthPrice" name="monthPrice">
                    </li>
                </ul>
            </form>

        <div>
            담당자:
            <form action="">
                <select name="admint" id="admin"></select>
            </form>
        </div>
        <div>
            < 고객 보험 계약 현황 >
        </div>

    </div>

    <style>
        ul{
            display: flex;
            flex-direction: column;
            width: 50%;
            height: 100%;
            list-style: none;
            text-decoration: none;
            margin: 0;
            padding: 0;
        }

        button {
            padding: 10px 20px;
        }

        ul > li {
            display: flex;
            flex-grow: 1;
        }

        ul > li > * {
            width: 50%;
        }


    </style>

    <script>
        const formContainer = document.getElementById('contractsForm');
        const customerList = document.getElementById('name');
        const contractList = document.getElementById('contractName');

        let customerRows = null;

        // fetch select list
        async function fetchSelect() {

            // customer
            const customersRq = "/api/customer";
            const customersRes = await fetch(customersRq, {method: 'GET'});
            customerRows = await customersRes.json();

            let customerHtml = "";
            for (const [i, r] of customerRows.entries()) {
                customerHtml += `<option class="name" value="${i}">${r.name}</option>`;
            }
            fetchCustomer(0);
            customerList.innerHTML = customerHtml;

            // contract
            const contractRq = "/api/contract";
            const contractRes = await fetch(contractRq, {method: 'GET'});
            const contractRows = await contractRes.json();

            let contractHtml = "";
            for (const r of contractRows) {
                contractHtml += `<option class="contractName" style="border-bottom:1px solid #f0f0f0; padding:8px 0;">${r.contractName}</option>`;
            }
            contractList.innerHTML = contractHtml;
        }

        fetchSelect()

        function fetchCustomer(i) {

            const selectedCustomer = customerRows[i];

            $('#code').val(selectedCustomer.code);
            $('#birth').val(selectedCustomer.birth);
            $('#tel').val(selectedCustomer.tel);
        }


    </script>

</div>
</body>
</html>